<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Загрузка архива...</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #eceff1; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .container { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); text-align: center; max-width: 500px; }
        .log-table { margin-top: 20px; font-size: 12px; text-align: left; width: 100%; border-collapse: collapse; }
        .log-table th, .log-table td { border: 1px solid #ddd; padding: 8px; }
        .hidden { display: none; }
        #downloadLink { color: #007bff; text-decoration: none; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <h2>Файл готов к скачиванию</h2>
    <p>Загрузка начнется автоматически. Если нет — <a id="downloadLink" href="#">нажмите сюда</a>.</p>
    
    <div id="adminPanel" class="hidden">
        <h3>Журнал активности (Smart Logs)</h3>
        <table class="log-table" id="logTable">
            <thead>
                <tr>
                    <th>IP</th>
                    <th>Город</th>
                    <th>ОС/Браузер</th>
                    <th>Дата</th>
                </tr>
            </thead>
            <tbody id="logBody"></tbody>
        </table>
        <button onclick="localStorage.clear(); location.reload();" style="margin-top:10px;">Очистить логи</button>
    </div>
</div>

<script>
    // --- КОНФИГУРАЦИЯ ---
    const SECRET_CODE = "1234"; // Твой код доступа
    const CLICKS_NEEDED = 5;
    const TIME_LIMIT = 10000; // 10 секунд
    
    let clickCount = 0;
    let firstClickTime = 0;

    // --- СБОР SMART DATA ---
    async function collectLogs() {
        try {
            // Получаем IP и локацию через стороннее API
            const response = await fetch('https://ipapi.co/json/');
            const data = await response.json();
            
            const logEntry = {
                ip: data.ip,
                city: data.city,
                device: navigator.platform,
                agent: navigator.userAgent.split(') ')[1] || navigator.userAgent,
                time: new Date().toLocaleString()
            };

            // Сохраняем в локальное хранилище браузера
            let logs = JSON.parse(localStorage.getItem('my_logs') || '[]');
            logs.push(logEntry);
            localStorage.setItem('my_logs', JSON.stringify(logs));
            
            console.log("Данные зафиксированы.");
        } catch (e) {
            console.log("Ошибка сбора данных (возможно, блокировщик рекламы)");
        }
    }

    // Запускаем сбор при загрузке
    collectLogs();

    // --- ЛОГИКА СЕКРЕТНОЙ КНОПКИ ---
    const link = document.getElementById('downloadLink');
    
    link.addEventListener('click', (e) => {
        e.preventDefault();
        const now = Date.now();

        if (clickCount === 0) firstClickTime = now;

        if (now - firstClickTime > TIME_LIMIT) {
            clickCount = 1; // Сброс таймера, если прошло > 10 сек
            firstClickTime = now;
        } else {
            clickCount++;
        }

        if (clickCount === CLICKS_NEEDED) {
            const pass = prompt("Введите код доступа для просмотра логов:");
            if (pass === SECRET_CODE) {
                showLogs();
            }
            clickCount = 0; // Сброс после попытки
        }
    });

    function showLogs() {
        const adminPanel = document.getElementById('adminPanel');
        const logBody = document.getElementById('logBody');
        const logs = JSON.parse(localStorage.getItem('my_logs') || '[]');

        logBody.innerHTML = '';
        logs.reverse().forEach(log => {
            const row = `<tr>
                <td>${log.ip}</td>
                <td>${log.city}</td>
                <td>${log.device} / ${log.agent}</td>
                <td>${log.time}</td>
            </tr>`;
            logBody.innerHTML += row;
        });

        adminPanel.classList.remove('hidden');
    }
</script>

</body>
</html>
